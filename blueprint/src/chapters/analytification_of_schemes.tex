%%% Local Variables: ***
%%% mode:latex ***
%%% TeX-master: "../content"
%%% End: ***

\chapter{Analytification of a scheme}


\section{Toplogical story}


\subsection{Affine scheme}

% \subsubsection{The special case of polynomial ring}

% In this section we work explicitly with $R := \complex[X_{1},\dots, X_{n}]$.

Let $S$ be a finitely generated $\complex$-algebra so that $S \cong \complex[a_{1},\dots, a_{n}]$ for some $a_{i} \in S$. Thus there is a surjection $\theta: \complex[X_{1}, \dots, X_{n}] \to S$ defined by $X_{i} \mapsto a_{i}$. Thus, we have a morphism $\Theta$ of schemes of finite type over $\complex$ between $\spec S$ to $\spec{\complex[X_{1},\dots, X_{n}]}$. By \Cref{thm:morph-maps-closed-points-to-closed-points}, we know that $\Theta$ gives us a continuous map
\[
%   We denote $\an{\left(\specop R\right)}$ to the space consisted of the closed points in $\specop R$ with the topology induced from $\complex^{n}$.
\operatorname{MaxSpec}\theta: \operatorname{MaxSpec} S \to \operatorname{MaxSpec} \complex[X_{1},\dots, X_{n}],
\]

since $\theta$ is surjective, $\operatorname{MaxSpec}\theta$ is injective\footnote{being the restriction of the injective function $\specop \theta$}.

\begin{theorem}
  The set of closed points in $\specop{\complex[X_{1},\dots, X_{n}]}$ corresponds bijectively to $\complex^{n}$.

\end{theorem}
\begin{proof}
  By \Cref{thm:affine-scheme-closed-points-biject-algebra-hom}, the set of closed points
  bijects to $\complex$-algebra homomorphisms $\complex[X_{1}, \dots, X_{n}] \to \complex$. Thus we only need a bijection between $\complex$-algebra homomorphism $\complex[X_{1}, \dots, X_{n}] \to \complex$ and $\complex^{n}$:
  \begin{enumerate}
    \item Give a point $p := (a_{1},\dots, a_{n}) \in \complex^{n}$, we define $\phi_{a}: \complex[X_{1},\dots, X_{n}] \to \complex$ to be evaluation at the point $p$.

    \item Give a $\complex$-algebra homomorphism $\phi$, we take the point to be $(\phi(X_{1}, \dots, X_{n}))$.
  \end{enumerate}
\end{proof}

\begin{definition}[Complex topology]
  The complex topology of $\specop S$ is the subspace topology of $\complex^{n}$ via the injective map $\maxspecop \theta$. With the complex topology, we denote $\maxspecop S$ as $\an{\left(\specop S\right)}$ and, if $\phi : S \to S'$ is a $\complex$-algebra homorphism, we the induced map between $\an{\specop{S'}}$ and $\an{\specop{S}}$ as $\an{\specop \phi}$.
\end{definition}

Note that by now we do not know that $\an{\left(\specop S\right)}$ is independent from the choice of generators $\{a_{1},\dots, a_{n}\}$, we will enventually prove that this is true, but let's write $\an{\left(\specop S\right)}_{a_{i}}$ to stress the dependency.

\begin{theorem}
If $S$, as $\complex$-algebras, is generated by both $a_{1},\dots, a_{n}$ and $b_{1},\dots,b_{m}$, we would have as topological spaces $\an{\left(\specop S\right)}_{a_{i}}$ and $\an{\left(\specop S\right)}_{b_{i}}$ are homeomophic.
\end{theorem}

\begin{proof}
  Let us abbreviate the polynomial rings $\complex[X_{1},\dots, X_{n}]$ as $R$ and $\complex[Y_{1},\dots, Y_{m}]$ as $R'$, then we have two surjective homomorphisms $\theta: R \to S$ and $\theta' : R' \to S$ such that $\theta(X_{i}) = a_{i}$ and $\theta'(Y_{i})=b_{i}$.

  It is sufficient, by symmetry, to prove topology induced by generators $b_{i}$'s is finer than that of $a_{i}$'s.

  Since $b_{i}$'s generate $S$ and $a_{i}$'s are in $S$, we can find $n$ polynomials $P_{i} \in R' = \complex[Y_{1},\dots, Y_{m}]$ such that $a_{i} = P_{i}(b_{1},\dots, b_{m})$. Thus we can define $\phi : R \to R'$ by $X_{i}\mapsto P_{i}(Y_{1},\dots, Y_{m})$ such that $\theta = \theta' \circ \phi$. Thus we have a commutative diagram (of plain functions)
  \begin{center}
    \begin{tikzcd}[column sep=large]
      {\an{\left(\specop{S}\right)}_{a_{i}}} \arrow{r}{\maxspecop\theta} \arrow[leftrightarrow]{d}[left]{=} & \complex^{n} \\
      {\an{\left(\specop{S}\right)}_{b_{i}}} \arrow{r}{\maxspecop{\theta'}} & \complex^{m} \arrow{u}[right]{\maxspecop{\phi}}
    \end{tikzcd}
  \end{center}

  It is sufficient to prove that $\maxspecop \phi$ is continuous, then since $\maxspecop \theta$, $\maxspecop \theta'$ and $\maxspecop \phi$ are all continuous, the identity function $\an{\left(\specop S\right)}_{a_{i}} \to \an{\left(\specop S\right)}_{b_{i}}$ is continuous.
  Consider a point $c = (c_{1},\dots, c_{m}) \in \complex^{m}$, then $\maxspecop\phi(c)$ is the point $\mathrm{eval}_{c} \circ \phi (X_{1},\dots, X_{n})$, i.e. $(c_{1},\dots, c_{m}) \mapsto (P_{1}(c_{1},\dots,c_{m}),\dots, P_{n}(c_{1},\dots,c_{m}))$. This is a map defined by polynomials, thus is continuous.
\end{proof}

Now we have proven that the complex topology is independent of generators, we can write $\an{\left(\specop S\right)}$ with a clear conscience.

\begin{lemma} Since $\an{\left(\specop S\right)}$, as a set, is just the set of closed points of $\specop S$, we have a function $\lambda: \an{\left(\specop S\right)} \hookrightarrow \specop S$. $\lambda$ is continuous where $\an{\left(\specop S\right)}$ is with complex topology while $\specop S$ is with the Zaraski toplogy.\label{thm:continuous-inclusion-complex-topology-affine}
\end{lemma}

\begin{proof}
  Let us choose a set of generators $a_{1},\dots, a_{n}$ and write $R := \complex[X_{1},\dots, X_{n}]$, then we would have the following commutative diagram:

  \begin{center}
    \begin{tikzcd}
      \an{\left(\specop{S}\right)} \arrow[hookrightarrow]{r}{\lambda_{S}} \arrow[red]{d}[left]{\mathrm{restriction~of}~\specop{\theta}}& \specop{S} \arrow{d}{\specop{\theta}} \\
      \an{\left(\specop{R}\right)} \arrow[hookrightarrow]{r}{\lambda_{R}} \arrow[red]{d}[left]{\sim} & \specop{R} \\
      \complex^{n} &
    \end{tikzcd},
  \end{center}
  where $\theta$ is the surjective $\complex$-algebra homomorphism $R \to S$.
  The red arrows are continuous, since they define the complex topology; $\specop \theta$ is continuous as well. To prove $\lambda_{S}$ is continuous, we only need to prove the special case $\lambda R$ where $R = \complex[X_{1},\dots, X_{n}]$. Since $\specop R$ has a basis of basic open set $D(f)$, we only need to check that $D(f) \cap \an{\left(\specop R\right)}$ is open for any polynomial $f \in \complex[X_{1}, \dots, X_{n}]$, indeed the intersection is equal to $\{x \in \complex^{n}| f(x) \ne 0 \}$ thus open\footnote{$\mathfrak{p} \in D(f)$ if and only if $f \not\in \mathfrak{p}$. Hence $\mathfrak{m}$ is in the intersection if and onlyv if $\mathfrak{m}$ is equal to the kernel of evaluation map $\phi_{a}$ at some point $a$ and that $f$ is not in the kernel, in another word, $f(a) \ne 0$.}\footnote{should this be a separate lemma?}. %FIXME
\end{proof}

\begin{theorem}\label{thm:continuous-an-spec-complex-toplogy}
  Let $S$ and $S'$ be two finitely generated $\complex$-algebras and $\phi : S \to S'$ be a $\complex$-algebra homomorphism, the natural map $\an{\specop{\phi}} : \an{\specop{S'}} \to \an{\specop{S}}$ is continuous (in the complex topology)
  and compatible with the inclusion map, i.e.~the following diagram is commutative:
  \begin{center}
    \begin{tikzcd}[column sep = large]
      {\an{\specop{S'}}} \arrow{r}{\an{\specop{\phi}}} \arrow[hookrightarrow]{d} & {\an{\specop{S}}} \arrow[hookrightarrow]{d} \\
      {\specop{S'}} \arrow{r}{\specop{\phi}} & \specop{S}
    \end{tikzcd}
  \end{center}
\end{theorem}

\begin{proof}
  The commutativity is free.
  Let us choose generators $\{a_{1},\dots,a_{n}\}$'s for $S$ and $\{b_{1},\dots,a_{m}\}$'s for $S'$.
  Let us write the polynomial ring $\complex[X_{1},\dots,X_{n}]$ as $R$ and $\complex[Y_{1},\dots, Y_{m}]$ as $R'$. Then we have two surjective $\complex$-algebra homomorphisms $\theta: R \to S$ and $\theta' : R' \to S'$ as usual.
  Since $\{b_{i}\}$ generates $S'$, we can find polynomials $P_{i} \in R'$ such that $\phi(a_{i})= P_{i}(b_{1},\dots, b_{m})$. Then we can define a $\complex$-algebra homomorphism $\psi : R \to R'$ by $X_{i} \mapsto P_{i}(Y_{1},\dots, Y_{m})$ giving us the following commutative diagrams:
  \begin{center}
    \begin{tikzcd}[column sep = large]
      & & & {\complex^{n}} & {\complex^{m}} \\
      R \arrow{r}{\psi} \arrow{d}{\theta}& R' \arrow{d}{\theta'} & & {\an{\specop{R}}} \arrow[red]{u}{\sim} & {\an{\specop{R'}}} \arrow{l}[above]{\an{\specop{\psi}}} \arrow[red]{u}{\sim} \\
      S \arrow{r}{\phi} & S' & & {\an{\specop{S}}} \arrow[red]{u}{\an{\specop{\theta}}} & {\an{\specop{S'}}} \arrow[red]{u}{\specop{\theta'}} \arrow{l}{\an{\specop{\phi}}}
    \end{tikzcd}
  \end{center}
  The red arrows are continuous because they define the complex topology and $\an{\specop{\psi}}$ is continuous because it is defined by polynomial $\psi$. Thus $\an{\specop{\phi}}$ is continuous.
\end{proof}

\begin{corollary}
  If $S \to S'$ is an isomorphism of finite $\complex$-algebras, then $\an{\specop{S}}$ and $\an{\specop{S'}}$ are homeomorphic.
\end{corollary}

\begin{lemma}
  If $\phi: S \to S'$ is a surjective $\complex$-algebra homomorphism between two finite $\complex$-algebras, then $\an{\specop{\phi}} : \an{\specop{S'}} \to \an{\specop{S}}$ is an embedding.
\end{lemma}

\begin{proof}
  Let $\{a_{1},\dots, a_{n}\}'s$ be generators of $S$ and $R$ be the polynomial ring $\complex[X_{1},\dots, X_{n}]$. Then we have $\theta : R \to S$ such that $\theta(X_{i})=a_{i}$. The composition $R \stackrel{\theta}{\to} S \stackrel{\phi}{\to} S'$ is a surjection as well. Thus by taking $\an{\specop(-)}$ operation, we get
  \begin{center}
    \begin{tikzcd}[column sep=large]
      {\an{\specop{S'}}} \arrow{r}{\an{\specop{\phi}}} & {\an{\specop{S}}} \arrow{r}{\an{\specop{\theta}}} & {\an{\specop{R}}} \arrow{r}{\sim} & \complex^n.
    \end{tikzcd}
  \end{center}
  The whole composition is embedding because of independence of generators and $\an{\specop{\theta}}$ is an embedding as well, thus $\an{\specop{\phi}}$ is an embedding as well.
\end{proof}

\begin{lemma}
  Let us write $\complex[X_{1},\dots,X_{n}]$ as $R$ and let $f \in R$ be a polynomial, then the localization map $\alpha : R \to R_{f}$ induces an embedding $\an{\specop{R_{f}}} \hookrightarrow \an{\specop{R}}$.
\end{lemma}
%TODO: prove this
\begin{proof}
TBD
\end{proof}

More generally, we have a corresponding lemma for arbitrary finite $\complex$-algebras.

\begin{lemma}
  If $S$ is a finite $\complex$-algebra and $f \in S$, then the localization map $\alpha : S \to S_{f}$ induces an embedding $\an{\specop{S_{f}}} \hookrightarrow \an{\specop{S}}$. In fact $\an{\specop{S_{f}}}$ is identified as the subset $D(f) \cap \specop{S}$ where $D(f)$ is the basic open set in $\specop{S}$.
\end{lemma}

% TODO
\begin{proof}
TBD
\end{proof}

\subsection{Arbitrary scheme}

\begin{definition}[Complex Topology]
 Let $\schemeOf{X}$ be a scheme locally of finite type over $\complex$, let $\mathcal{I}$ be the collection of open immersions $\spec R \to X$ where $R$ is some finite $\complex$-algebra. Then the complex topology on the set of closed points $\max X$ is defined as the weak topology with respect to $\left\{\an{{\phi}} | (\phi, \phi^{*}) \in \mathcal{I}\right\}$ where $\an{\phi}$ is the restriction of $\phi$ to the subset of closed points. When we talk about complex toplogy, we write $\max{X}$ as $\an{X}$.
\end{definition}

% If $\Psi = (\psi, \psi^{*}) : \spec{R} \to X$ is an open immersion where $R$ is a finite $\complex$-algebra, by the definition of the complex topology, we know that $\an{{\psi}}$ is continuous, in fact it is an embedding as well where the image is open. Let $W \subseteq \an{\specop R}$ be an open subset, we need to show the image of $W$, $\an{\psi} W = \psi W$ is open in $\an{X}$. Let $S$ be an arbitrary finite $\complex$-algebra and $\Phi = (\phi, \phi^{*}) : \specop{S} \to \schemeOf{X}$ be an open immersion, we need to show that the inverse image of $\psi W$, ${\an{\phi}}^{-1}\psi W = \phi^{-1}\psi W$, is open in $\an{\specop S}$. Let $U$ be the image of $\phi^{-1}\psi W$ under $\an{\phi}$ and $V$ be the image under $\an{\psi}$. Then we have $\psi W \subseteq \max{V}$ (the closed points in $V$)

\begin{lemma}\label{thm:open-immersion-induced-embedding-complex-topology}
  Let $\schemeOf{X}$ be a scheme locally of finite type over $\complex$, $R$ be a finite $\complex$-algebra and $\Psi = (\psi, \psi^{*}) : \spec{R} \to \schemeOf{X}$ be an open immersion. Then $\an{\psi}$ is an embedding.
\end{lemma}

\begin{proof}
  TBD
\end{proof}

\begin{lemma}\label{thm:continuous-inclusion-complex-topology}
  Let $\lambda_{X} : \an{X} \hookrightarrow X$ be the inclusion map, then $\lambda_{X}$ is continuous.
\end{lemma}
\begin{proof}
  Let $x \in X$ and $U \cong \specop A$ be an open affine neighbourhood of $x$. Then we have the following commutative diagram:
  \begin{center}
    \begin{tikzcd}
      {\an{\specop{A}}} \arrow[hookrightarrow, red]{d} \arrow{r}{\iota_1} & {\an{X}} \arrow[hookrightarrow]{d}{\lambda_{X}} \\
      {\specop{A}} \arrow[hookrightarrow]{r} \arrow{r}{\iota_2} & X.
    \end{tikzcd}
  \end{center}
  The red arrow is continuous by \Cref{thm:continuous-inclusion-complex-topology-affine}; $\iota_{1}$ is continuous by \Cref{thm:open-immersion-induced-embedding-complex-topology}; $\iota_{2}$ is an open embedding by hypothesis. Thus $\lambda_{X}$ is continuous as well.
\end{proof}

\begin{lemma}
  Let $\Phi = (\phi, \phi^{*}) : \schemeOf{X} \to \schemeOf{Y}$ be a morphism of schemes locally of finite type over $\complex$, then $\an{\phi} : \an{X} \to \an{Y}$ is continuous.
\end{lemma}
\begin{proof}
  Let $x \in X$ and $U \cong \specop A \subseteq X$ and $V \cong \specop B \subseteq Y$ such that $\phi U \subseteq V$ be affine neighbourhoods around $x$ and $\phi(x)$\footnote{This is possible by definition of being locally finite.}. Then $\Phi|_{U} : \spec A \to \spec B$ is induced by a $\complex$-algebra homomorphism $\alpha: B \to A$, thus we have the following two commutative squares:
  \begin{center}
    \begin{tikzcd}[column sep=large]
      {\spec{A}} \arrow{r}{\spec{\alpha}} \arrow[hookrightarrow]{d} & {\spec{B}} \arrow[hookrightarrow]{d} & {\an{\specop{A}}} \arrow[hookrightarrow, red]{d} \arrow{r}{\an{\specop{\alpha}}} & {\an{\specop{B}}} \arrow[hookrightarrow, red]{d}\\
      {\schemeOf{X}} \arrow{r}{\Phi} & {\schemeOf{Y}} & {\an{X}} \arrow{r}{\an{\phi}} & \an{Y}.
    \end{tikzcd}
  \end{center}
  where the red arrows are continuous by \Cref{thm:continuous-inclusion-complex-topology} and $\an{\specop\alpha}$ is continuous by \Cref{thm:continuous-an-spec-complex-toplogy}. Thus $\an{\phi}$ is continuous as well.
\end{proof}

\begin{corollary}
  Let $\Phi : \schemeOf{X} \to \schemeOf{Y}$ be an open immersion of schemes locally of finite type over $\complex$, then $\an{\phi}$ is an embedding of $\an{X}$ into $\an{Y}$.
\end{corollary}
\begin{proof}
  TBD
\end{proof}

Here are two easy consequences:
\begin{corollary}
  Given two morphisms among schemes locally of finite type over $\complex$
  \begin{center}
    \begin{tikzcd}
      {\schemeOf{X}} \arrow{r}{(\phi, \phi^{*})} & {\schemeOf{Y}} \arrow{r}{(\psi, \psi^{*})} & {\schemeOf{Z}},
    \end{tikzcd}
  \end{center}
  we have $\an{\psi\circ\phi} = \an{\psi} \circ \an{\phi}$
\end{corollary}
\begin{proof}
 Restriction of composition is composition of restriction.
\end{proof}

\begin{corollary}
  Let $\Phi = (\phi, \phi^{*}) : \schemeOf{X} \to \schemeOf{Y}$ be a morphism of schemes locally of finite type over $\complex$, we have
  \begin{center}
    \begin{tikzcd}
      {\an{X}} \arrow{r}{{\an{\phi}}} \arrow[hookrightarrow]{d} & {\an{Y}} \arrow[hookrightarrow]{d} \\
      X \arrow{r}{\phi} & Y
    \end{tikzcd}
  \end{center}
\end{corollary}


\section{Sheaf side}

In previous section, we have showed that for any scheme $\schemeOf{X}$ locally of finite type over $\complex$, we can make a topological space $\an{X}$ with the complex topology. In this section, we aim to make a sheaf $\an{\mathcal{O}_{X}}$ on $\an{X}$. We will consider the affine cases $\spec{S}$ where $S$ is a finite $\complex$-algebra by choosing generators; then we prove that the construction does not dependent on the choice of generators; then we glue everything together.

\subsection{Affine schemes}
Let $S$ be a finite $\complex$-algebra, we choose generators $a_{1},\dots, a_{n}$ and write $\complex[X_{1},\dots,X_{n}]$ as $R$. Thus we have a surjective $\complex$-algebra homomorphism $\theta: R \to S$ such that $\theta(X_{i}) = a_{i}$. Then $\ker\theta$ is finitely generated as well, say by $f_{1},\dots,f_{m}$. We do constructions using $f_{1},\dots, f_{m}$, so everything depends on the choice of $a_{1},\dots,a_{n}$.
